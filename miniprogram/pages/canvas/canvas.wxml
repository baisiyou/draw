<!--canvas.wxml-->
<view class="container">
  <!-- è¯­è¨€åˆ‡æ¢æŒ‰é’® -->
  <view class="lang-switch-btn" bindtap="switchLanguage">
    <text class="lang-text">{{language === 'zh-CN' ? 'EN' : 'ä¸­æ–‡'}}</text>
  </view>

  <!-- æ¨ªå‘å·¥å…·æ  -->
  <view class="toolbar {{toolbarExpanded ? 'expanded' : 'collapsed'}}">
    <!-- å·¦ä¾§ï¼šæ’¤é”€/é‡åš -->
    <view class="toolbar-section">
      <view class="tool-btn-icon" bindtap="undo">
        <text class="icon">â†¶</text>
      </view>
      <view class="tool-btn-icon" bindtap="redo">
        <text class="icon">â†·</text>
      </view>
    </view>
    
    <!-- ä¸­é—´ï¼šå½“å‰å·¥å…·ï¼ˆæ”¶èµ·æ—¶ï¼‰æˆ–æ‰€æœ‰å·¥å…·ï¼ˆå±•å¼€æ—¶ï¼‰ -->
    <view class="toolbar-section tools-section">
      <!-- æ”¶èµ·çŠ¶æ€ï¼šåªæ˜¾ç¤ºå½“å‰å·¥å…·å’Œå±•å¼€æŒ‰é’® -->
      <view class="current-tool-display" wx:if="{{!toolbarExpanded}}">
        <view class="tool-item active" bindtap="toggleToolbar">
          <text>{{toolNames[currentTool] || 'ç”»ç¬”'}}</text>
        </view>
        <view class="tool-btn-icon expand-btn" bindtap="toggleToolbar">
          <text class="icon">â–¼</text>
        </view>
      </view>
      
      <!-- å±•å¼€çŠ¶æ€ï¼šæ˜¾ç¤ºæ‰€æœ‰å·¥å…· -->
      <scroll-view class="tools-scroll" scroll-x wx:if="{{toolbarExpanded}}">
        <view class="tool-item {{currentTool === 'select' ? 'active' : ''}}" data-tool="select" bindtap="selectTool">
          <text>é€‰æ‹©</text>
        </view>
        <view class="tool-item {{currentTool === 'pen' ? 'active' : ''}}" data-tool="pen" bindtap="selectTool">
          <text>ç”»ç¬”</text>
        </view>
        <view class="tool-item {{currentTool === 'rectangle' ? 'active' : ''}}" data-tool="rectangle" bindtap="selectTool">
          <text>çŸ©å½¢</text>
        </view>
        <view class="tool-item {{currentTool === 'ellipse' ? 'active' : ''}}" data-tool="ellipse" bindtap="selectTool">
          <text>åœ†å½¢</text>
        </view>
        <view class="tool-item {{currentTool === 'diamond' ? 'active' : ''}}" data-tool="diamond" bindtap="selectTool">
          <text>è±å½¢</text>
        </view>
        <view class="tool-item {{currentTool === 'arrow' ? 'active' : ''}}" data-tool="arrow" bindtap="selectTool">
          <text>ç®­å¤´</text>
        </view>
        <view class="tool-item {{currentTool === 'line' ? 'active' : ''}}" data-tool="line" bindtap="selectTool">
          <text>ç›´çº¿</text>
        </view>
        <view class="tool-item {{currentTool === 'text' ? 'active' : ''}}" data-tool="text" bindtap="selectTool">
          <text>æ–‡å­—</text>
        </view>
        <view class="tool-item {{currentTool === 'eraser' ? 'active' : ''}}" data-tool="eraser" bindtap="selectTool">
          <text>æ©¡çš®</text>
        </view>
      </scroll-view>
    </view>
    
    <!-- å³ä¾§ï¼šå±æ€§è®¾ç½®å’Œæ“ä½œ -->
    <view class="toolbar-section toolbar-right">
      <view class="property-item" bindtap="showColorPicker">
        <view class="color-preview" style="background-color: {{appState.currentItemStrokeColor}}"></view>
      </view>
      <view class="property-item" bindtap="showStrokeWidthPicker">
        <view class="stroke-width-preview" style="width: {{appState.currentItemStrokeWidth * 2}}rpx;"></view>
      </view>
      <view class="property-item" bindtap="toggleFill">
        <view class="fill-preview" style="background-color: {{appState.currentItemBackgroundColor === 'transparent' ? '#f0f0f0' : appState.currentItemBackgroundColor}}"></view>
      </view>
      <view class="tool-btn-icon" bindtap="saveDrawing">
        <text class="icon">ğŸ’¾</text>
      </view>
      <view class="tool-btn-icon" bindtap="exportDrawing">
        <text class="icon">ğŸ“¤</text>
      </view>
      <view class="tool-btn-icon" wx:if="{{selectedElementId}}" bindtap="deleteSelected">
        <text class="icon">ğŸ—‘</text>
      </view>
      <view class="tool-btn-icon" bindtap="clearCanvas">
        <text class="icon">ğŸ—‘</text>
      </view>
      <view class="tool-btn-icon collapse-btn" wx:if="{{toolbarExpanded}}" bindtap="toggleToolbar">
        <text class="icon">â–²</text>
      </view>
    </view>
  </view>

  <!-- ç”»å¸ƒ -->
  <view class="canvas-wrapper" catchtouchstart="{{!showTextInput ? 'touchStart' : ''}}" catchtouchmove="{{!showTextInput ? 'touchMove' : ''}}" catchtouchend="{{!showTextInput ? 'touchEnd' : ''}}">
  <canvas 
    class="canvas"
    canvas-id="{{canvasId}}"
    disable-scroll="true"
      style="width: 100%; height: 100%;"
  ></canvas>
  </view>

  <!-- æ–‡å­—è¾“å…¥æ¡†é®ç½© -->
  <view class="text-input-mask" wx:if="{{showTextInput}}" catchtap="onTextInputCancel"></view>
  <!-- æ–‡å­—è¾“å…¥æ¡† -->
  <view class="text-input-container" wx:if="{{showTextInput}}" style="left: {{textInputX}}px; top: {{textInputY}}px;">
    <textarea 
      class="text-input"
      placeholder="{{texts.inputText || 'è¾“å…¥æ–‡å­—'}}"
      value="{{textInputValue}}"
      bindconfirm="onTextInputConfirm"
      bindblur="onTextInputBlur"
      bindinput="onTextInput"
      focus="{{showTextInput}}"
      maxlength="50"
      auto-focus="{{true}}"
      auto-height="{{true}}"
      hold-keyboard="{{true}}"
      bindfocus="onTextInputFocus"
    ></textarea>
    <view class="text-input-actions">
      <button class="text-input-btn confirm-btn" size="mini" bindtap="confirmTextInput">{{texts.confirm || 'ç¡®å®š'}}</button>
      <button class="text-input-btn cancel-btn" size="mini" bindtap="onTextInputCancel">{{texts.cancel || 'å–æ¶ˆ'}}</button>
    </view>
  </view>

  <!-- é¢œè‰²é€‰æ‹©å™¨ -->
  <view class="color-picker" wx:if="{{showColorPicker}}">
    <view class="color-picker-title">{{texts.selectColor || 'é€‰æ‹©é¢œè‰²'}}</view>
    <view class="color-grid">
      <view 
        class="color-item {{appState.currentItemStrokeColor === color ? 'active' : ''}}"
        wx:for="{{presetColors}}"
        wx:key="index"
        style="background-color: {{item}}"
        data-color="{{item}}"
        bindtap="selectColor"
      ></view>
    </view>
  </view>

  <!-- ç”»ç¬”ç²—ç»†é€‰æ‹©å™¨ -->
  <view class="stroke-width-picker" wx:if="{{showStrokeWidthPicker}}">
    <view class="stroke-width-picker-title">{{texts.selectWidth || 'é€‰æ‹©ç²—ç»†'}}</view>
    <view class="stroke-width-list">
      <view 
        class="stroke-width-item {{appState.currentItemStrokeWidth === item ? 'active' : ''}}"
        wx:for="{{strokeWidths}}"
        wx:key="index"
        data-width="{{item}}"
        bindtap="selectStrokeWidth"
      >
        <view class="stroke-width-line" style="width: {{item * 2}}rpx; height: {{item * 2}}rpx;"></view>
        <text>{{item}}px</text>
    </view>
    </view>
  </view>

</view>
